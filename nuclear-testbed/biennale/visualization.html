<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Venice Biennale 2021</title>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/vis.css" />
    <link rel="stylesheet" href="css/message.css" />
    <link rel="stylesheet" href="css/questions.css" />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;500&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div id="body">
      <div id="vis-container">
        <canvas id="vis">Error, canvas is not supported</canvas>
        <h2 id="title" class="p-4">How will we live together?</h2>
        <div id="left-sidebar" class="hide_scroll h-border-right">
          some header here
        </div>
        <div id="right-sidebar" class="hide_scroll">
          <h2 class="p-3">&nbsp</h2>
          <h5 id="inputCount" class="m-0">0</h5>
          <div class="text pb-2">Participants & counting...</div>
          <h5 id="utcTime" class="m-0">00:00:00</h5>
          <div class="text pb-2">GMT<span id="gmt"></span></div>
          <div class="text pb-3">
            Lorem Ipsum is simply dummy text of the printing and typesetting
            industry. Lorem Ipsum has been the industry's standard dummy text
            ever since the 1500s, when an unknown printer took a galley of type
            and scrambled it to make a type specimen book. It has survived not
            only five centuries, but also the leap into electronic typesetting,
            remaining essentially unchanged. It
          </div>
          <div class="text">Filter:</div>
          <div id="filter" class="container-fluid pb-3">
            <div class="row no-gutters pl-1">
              <div class="form-check col-6">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="messages"
                  name="messages"
                  onchange="toggleMessages('messages')"
                  checked
                />
                <label class="form-check-label" for="messages">Messages</label>
              </div>
              <div class="form-check col-6">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="occupants"
                  name="occupants"
                  onchange="toggleOccupants('occupants')"
                  checked
                />
                <label class="form-check-label" for="occupants"
                  >Occupants</label
                >
              </div>
              <div class="form-check col-6">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="unitParcel"
                  name="unitParcel"
                  onchange="toggleUnitParcel('unitParcel')"
                  checked
                />
                <label class="form-check-label" for="unitParcel"
                  >Unit Parcel</label
                >
              </div>
              <div class="form-check col-6">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="sharedSpaces"
                  name="sharedSpaces"
                  onchange="toggleSharedSpaces('sharedSpaces')"
                  checked
                />
                <label class="form-check-label" for="sharedSpaces"
                  >Public Spaces</label
                >
              </div>
            </div>
          </div>
          <div id="open_modal_buttons">
            <button
              type="button"
              class="btn btn-primary btn-md btn-block"
              onclick="setModalState('questions')"
            >
              Create Your Unit
            </button>
            <button
              type="button"
              class="btn btn-secondary btn-md btn-block"
              onclick="setModalState('comment')"
            >
              Leave a Comment
            </button>
          </div>
        </div>
      </div>
      <div id="nav_controls" class="pb-5">
        <a
          id="menu_button"
          class="a_btn pb-3"
          href="#open"
          onclick="toggleMenu('menu_button')"
          ><i class="material-icons icon mb-3">menu_open</i></a
        >
        <a class="a_btn" href="#" onclick="buildingZoom(0.5)"><h3>+</h3></a>
        <hr />
        <a class="a_btn" href="#" onclick="buildingZoom(-0.5)"><h3>-</h3></a>
      </div>

      <div
        id="questions_modal_container"
        class="modal_container hide_scroll fadeIn fadeOut p-2"
        style="display: none;"
      ></div>
      <div
        id="message_modal_container"
        class="modal_container fadeIn fadeOut p-2"
        style="display: none;"
      >
        <div id="message" class="modal_window">
          <div id="message_window_header" class="pt-3 pr-5 pl-3">
            <a
              id="message_topic_button"
              class="a_btn_modal"
              href="#"
              onclick="toggleMessageTopicsMenu('message_topic_button')"
              ><h3 class="d-inline">Topics Loading</h3>
              <i class="d-inline material-icons icon px-2">expand_more</i></a
            >
          </div>
          <a
            class="modal_close_button p-3"
            href="#closed"
            onclick="setModalState(null)"
            ><i class="material-icons icon">remove</i></a
          >
          <div id="message_topics_dropdown" class="p-3">
            <a class="a_btn_modal" href="#closed" onclick="setModalState(null)"
              ><h4>Crocodiles</h4></a
            >
            <hr />
            <a class="a_btn_modal" href="#closed" onclick="setModalState(null)"
              ><h4>like</h4></a
            >
            <a class="a_btn_modal" href="#closed" onclick="setModalState(null)"
              ><h4>a</h4></a
            >
            <a class="a_btn_modal" href="#closed" onclick="setModalState(null)"
              ><h4>good</h4></a
            >
            <a class="a_btn_modal" href="#closed" onclick="setModalState(null)"
              ><h4>dip</h4></a
            >
            <a class="a_btn_modal" href="#closed" onclick="setModalState(null)"
              ><h4>of</h4></a
            >
            <a class="a_btn_modal" href="#closed" onclick="setModalState(null)"
              ><h4>water</h4></a
            >
          </div>
          <div class="message_modal_body">
            <ul class="message_list hide_scroll px-3">
              <li class="message_left appeared">
                <hr />
                <div class="timestamp">Timestamp</div>
                <div class="message_wrapper">
                  <input class="message_reply" value="I am a reply" disabled />
                  <div class="messsage_text pt-1">
                    Biennalebienallesbienalenbielbluiblulblub
                    Biennalebienallesbienalenbielbluiblulblub
                    Biennalebienallesbienalenbielbluiblulblub
                    Biennalebienallesbienalenbielbluiblulblub
                  </div>
                </div>
              </li>
              <li class="message_right appeared">
                <div class="message_wrapper">
                  <div class="messsage_text">
                    Biennalebienallesbienalenbielbluiblulblub
                  </div>
                </div>
              </li>
            </ul>
            <div
              id="message_reply_popup"
              class="pt-2 px-5"
              style="display: none;"
            >
              <div id="message_reply_input" class="d-inline-block"></div>
              <a
                href="#"
                id="reply_cancel_button"
                class="a_btn_modal float-right"
                onclick="setReply()"
                ><i class="material-icons icon">clear</i></a
              >
            </div>
          </div>
          <div class="message_input_footer my-2 p-3 clearfix">
            <div class="message_input_wrapper">
              <input
                class="message_input"
                placeholder="Type your message here..."
              />
              <a
                href="#"
                id="send_button"
                class="a_btn_modal send_button p-3"
                onclick="processMessage()"
              >
                <i class="material-icons icon">send</i>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="js/canvas-txt.js"></script>
    <script src="https://unpkg.com/dayjs@1.8.21/dayjs.min.js"></script>
    <script src="https://unpkg.com/dayjs@1.8.21/plugin/utc.js"></script>
    <script>
      dayjs.extend(window.dayjs_plugin_utc);
    </script>
    <script src="js/jquery-3.4.1.min.js"></script>
    <!-- <script type="text/javascript"> -->

    <!-- </script> -->
    <script src="js/vis.js"></script>
    <!-- Load React. -->
    <!-- Note: when deploying, replace "development.js" with "production.min.js". -->
    <script
      src="https://unpkg.com/react@16/umd/react.development.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"
      crossorigin
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/@material-ui/core/umd/material-ui.development.js"
    ></script>

    <!-- html templates -->
    <script id="topicItemTemplate" type="text/html">
      <div><a class="a_btn_modal" href="#"><h4 class="p-1">Crocodiles</h4></a></div>
    </script>
    <script id="messageTemplate" type="text/html">
      <div>
      <li class="my-3">
      	<hr>
      	<div class="timestamp d-none d-md-block font-italic small">Timestamp</div>
      	<div class="message_wrapper ml-5">
      		<div class="message_text"></div>
      	</div>
      </li>
      </div>
    </script>
    <script id="messageReplyTemplate" type="text/html">
      <div>
      <li class="my-3">
      	<hr>
      	<div class="timestamp d-none d-md-block font-italic small">Timestamp</div>
      	<div class="message_wrapper ml-5">
      		<div class="message_reply px-2"></div>
      		<div class="message_text pt-1"></div>
      	</div>
      </li>
      </div>
    </script>

    <script src="js/modal-questions.js"></script>
    <script src="js/modal-message.js"></script>
    <script src="js/modal-handler.js"></script>
    <script type="text/javascript">
      /*-----------------------------ENDPOINTS AND RUNTIME SCRIPT-----------------------------------*/
      const endpoint = 'http://127.0.0.1:5000/';
      const messageUrl = endpoint + 'message';
      const parcelationUrl = endpoint + 'parcelation';

      function pullParcelation() {
        fetch(parcelationUrl, { method: 'GET' })
          .then((response) => response.json())
          .then((data) => {
            //log(data);
            parcelSys.updateUnits(JSON.parse(data.parcelation));
            document.getElementById('inputCount').innerHTML = data.inputCount;
          });
      }

      const messageIds = [];
      let messageDict = {};
      let topics = [];
      function pullMessages() {
        fetch(messageUrl, { method: 'GET' })
          .then((response) => response.json())
          .then((messageData) => {
            for (let i = 0; i < messageData.length; i++) {
              let messages = messageData[i].messages;
              for (let k = 0; k < messages.length; k++) {
                if (!messageDict.hasOwnProperty(messages[k].messageId)) {
                  messageIds.push(messages[k].messageId);
                  messageIds.sort(function (a, b) {
                    return a - b;
                  }); //ideally use a sorted tree for this
                  messageDict[messages[k].messageId] = {
                    topicId: i,
                    timestamp: messages[k].timestamp,
                    reply: messages[k].reply,
                    message: messages[k].message,
                  };
                  filterTopic(topicId);
                  //log(messageDict[messages[k].messageId]); //newly added
                }
              }
              //load topics after to reload spinner data
              if (i + 1 > topics.length) {
                topics.push(messageData[i].topic);
                updateTopics();
              }
            }
            bubbleSys.updateMessages(messageData);
          });
      }

      if (isMobile.any()) toggleMenu('menu_button', 'close');
      else toggleMenu('menu_button', 'open');
      start();
    </script>
  </body>
</html>
